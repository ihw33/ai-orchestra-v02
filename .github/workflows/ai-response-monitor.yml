name: AI Response Monitor

on:
  issue_comment:
    types: [created]
  
jobs:
  check-ai-response:
    if: contains(github.event.comment.body, 'âœ…')
    runs-on: ubuntu-latest
    
    steps:
      - name: Check AI Responses
        uses: actions/github-script@v7
        with:
          script: |
            const issueNumber = context.issue.number;
            const comment = context.payload.comment.body;
            const repo = context.repo;
            
            // AI ì™„ë£Œ íŒ¨í„´ í™•ì¸
            const aiPatterns = {
              'ai-claude-done': /âœ… Claude/,
              'ai-gemini-done': /âœ… Gemini/,
              'ai-codex-done': /âœ… Codex/
            };
            
            // í•´ë‹¹í•˜ëŠ” ë¼ë²¨ ì¶”ê°€
            for (const [label, pattern] of Object.entries(aiPatterns)) {
              if (pattern.test(comment)) {
                await github.rest.issues.addLabels({
                  owner: repo.owner,
                  repo: repo.repo,
                  issue_number: issueNumber,
                  labels: [label]
                });
                
                console.log(`Added label: ${label}`);
              }
            }
            
            // í˜„ì¬ ë¼ë²¨ í™•ì¸
            const { data: issue } = await github.rest.issues.get({
              owner: repo.owner,
              repo: repo.repo,
              issue_number: issueNumber
            });
            
            const labels = issue.labels.map(l => l.name);
            
            // ëª¨ë“  AI ì™„ë£Œ í™•ì¸
            if (labels.includes('ai-claude-done') && 
                labels.includes('ai-gemini-done') && 
                labels.includes('ai-codex-done')) {
              
              // ëª¨ë“  AI ì™„ë£Œ ë¼ë²¨ ì¶”ê°€
              await github.rest.issues.addLabels({
                owner: repo.owner,
                repo: repo.repo,
                issue_number: issueNumber,
                labels: ['ai-responded']
              });
              
              // PMì—ê²Œ ì•Œë¦¼ (ì´ìŠˆ ì½”ë©˜íŠ¸ë¡œ)
              await github.rest.issues.createComment({
                owner: repo.owner,
                repo: repo.repo,
                issue_number: issueNumber,
                body: `## ğŸ‰ ëª¨ë“  AI ì‘ì—… ì™„ë£Œ!\n\nâœ… Claude: ì™„ë£Œ\nâœ… Gemini: ì™„ë£Œ\nâœ… Codex: ì™„ë£Œ\n\n@ihw33 ëª¨ë“  AIê°€ ì‘ì—…ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.`
              });
            }

  notify-pm:
    if: contains(github.event.issue.labels.*.name, 'ai-responded')
    runs-on: ubuntu-latest
    needs: check-ai-response
    
    steps:
      - name: Send notification
        run: |
          echo "ğŸ”” PM Claudeì—ê²Œ ì•Œë¦¼: ì´ìŠˆ #${{ github.event.issue.number }}ì˜ ëª¨ë“  AI ì‘ì—… ì™„ë£Œ"