# DEPRECATED: AI OrchestraëŠ” ì´ì œ ë¡œì»¬ì—ì„œ ì§ì ‘ ì‹¤í–‰í•©ë‹ˆë‹¤
# PM Claudeê°€ ì´ìŠˆ ìƒì„±ê³¼ ë™ì‹œì— multi_ai_orchestrator.pyë¥¼ ì‹¤í–‰
# GitHub ActionsëŠ” ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•ŠìŒ

# name: AI Orchestra - Multi AI Collaboration
# 
# on:
#   issues:
#     types: [opened, edited, labeled]
#   issue_comment:
#     types: [created]
# 
# jobs:
  ai-orchestra:
    runs-on: ubuntu-latest
    
    # [AI] íƒœê·¸ë‚˜ ai-task ë¼ë²¨ì´ ìˆì„ ë•Œë§Œ ì‹¤í–‰
    if: |
      (contains(github.event.issue.title, '[AI]') || 
       contains(github.event.issue.labels.*.name, 'ai-task')) &&
      github.event.issue.state == 'open'
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          pip install requests PyGithub
          # AI CLI ë„êµ¬ë“¤ ì„¤ì¹˜ (ì‹¤ì œ í™˜ê²½ì— ë§ê²Œ ìˆ˜ì • í•„ìš”)
          # npm install -g gemini-cli claude-cli codex-cli
      
      - name: Analyze issue for persona
        id: analyze
        run: |
          python3 << 'EOF'
          import json
          import os
          
          # ì´ìŠˆ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          issue_title = os.environ.get('ISSUE_TITLE', '')
          issue_body = os.environ.get('ISSUE_BODY', '')
          full_content = f"{issue_title}\n{issue_body}"
          
          # í˜ë¥´ì†Œë‚˜ ê²°ì • ë¡œì§
          persona = 'balanced'
          urgency = 'normal'
          
          if any(word in full_content.lower() for word in ['ê¸´ê¸‰', 'ë¹¨ë¦¬', 'urgent', 'asap']):
              persona = 'speedster'
              urgency = 'high'
          elif any(word in full_content.lower() for word in ['ì™„ë²½', 'ê¼¼ê¼¼', 'perfect', 'thorough']):
              persona = 'perfectionist'
              urgency = 'perfect'
          elif any(word in full_content.lower() for word in ['ë²„ê·¸', 'ë¬¸ì œ', 'bug', 'issue', 'error']):
              persona = 'critic'
          elif any(word in full_content.lower() for word in ['ê°„ë‹¨', 'ìµœì†Œ', 'simple', 'minimal']):
              persona = 'minimalist'
          
          # ì›Œí¬í”Œë¡œìš° ê²°ì •
          workflow = 'parallel'
          if any(word in full_content.lower() for word in ['ë²„ê·¸', 'bug', 'ìˆ˜ì •', 'fix']):
              workflow = 'relay'
          
          print(f"::set-output name=persona::{persona}")
          print(f"::set-output name=urgency::{urgency}")
          print(f"::set-output name=workflow::{workflow}")
          
          # ë¶„ì„ ê²°ê³¼ ë¡œê·¸
          print(f"Persona: {persona}, Urgency: {urgency}, Workflow: {workflow}")
          EOF
        env:
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_BODY: ${{ github.event.issue.body }}
      
      - name: Create AI prompts
        id: prompts
        run: |
          python3 << 'EOF'
          import os
          import json
          
          persona = "${{ steps.analyze.outputs.persona }}"
          urgency = "${{ steps.analyze.outputs.urgency }}"
          issue_title = os.environ.get('ISSUE_TITLE', '')
          issue_body = os.environ.get('ISSUE_BODY', '')
          
          # í˜ë¥´ì†Œë‚˜ë³„ ìŠ¤íƒ€ì¼
          persona_styles = {
              'speedster': 'âš¡ ë¹ ë¥´ê³  ê°„ê²°í•˜ê²Œ. í•µì‹¬ë§Œ êµ¬í˜„. MVP ìš°ì„ .',
              'perfectionist': 'â­ ì™„ë²½í•˜ê³  ê¼¼ê¼¼í•˜ê²Œ. ëª¨ë“  ì—£ì§€ì¼€ì´ìŠ¤ ì²˜ë¦¬.',
              'critic': 'ğŸ” ë¹„íŒì ìœ¼ë¡œ ë¶„ì„. ë¬¸ì œì  ìš°ì„  íŒŒì•….',
              'minimalist': 'âœ¨ ìµœì†Œí•œì˜ ì½”ë“œë¡œ. ë‹¨ìˆœí•˜ê³  ëª…í™•í•˜ê²Œ.',
              'balanced': 'âš–ï¸ ê· í˜•ì¡íŒ ì ‘ê·¼. ì‹¤ìš©ì ì¸ í•´ê²°ì±….'
          }
          
          style = persona_styles.get(persona, persona_styles['balanced'])
          
          # ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
          base_prompt = f"""
í˜ë¥´ì†Œë‚˜: {persona}
ì‘ì—… ìŠ¤íƒ€ì¼: {style}
ê¸´ê¸‰ë„: {urgency}

ì´ìŠˆ ì œëª©: {issue_title}
ì´ìŠˆ ë‚´ìš©: {issue_body}

ë‹¹ì‹ ì˜ ì—­í• ì— ë§ê²Œ ì´ ì´ìŠˆë¥¼ í•´ê²°í•˜ì„¸ìš”.
{persona} ìŠ¤íƒ€ì¼ë¡œ ì ‘ê·¼í•˜ì„¸ìš”.
"""
          
          # ê° AIë³„ í”„ë¡¬í”„íŠ¸
          gemini_prompt = base_prompt + "\nì—­í• : ì•„í‚¤í…ì²˜ ì„¤ê³„ & ì „ì²´ êµ¬ì¡°ì— ì§‘ì¤‘"
          claude_prompt = base_prompt + "\nì—­í• : ì‹¤ì œ êµ¬í˜„ê³¼ ì½”ë“œ í’ˆì§ˆì— ì§‘ì¤‘"
          codex_prompt = base_prompt + "\nì—­í• : ë°±ì—”ë“œ ë¡œì§ê³¼ API ì„¤ê³„ì— ì§‘ì¤‘"
          
          # ì¶œë ¥ (GitHub Actionsì—ì„œ ì‚¬ìš©)
          print(f"::set-output name=gemini_prompt::{json.dumps(gemini_prompt)}")
          print(f"::set-output name=claude_prompt::{json.dumps(claude_prompt)}")
          print(f"::set-output name=codex_prompt::{json.dumps(codex_prompt)}")
          EOF
        env:
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_BODY: ${{ github.event.issue.body }}
      
      - name: Call AI APIs (ë³‘ë ¬ ì²˜ë¦¬)
        id: ai_results
        run: |
          # ì‹¤ì œ AI API í˜¸ì¶œ (ì˜ˆì‹œ)
          # ì‹¤ì œ êµ¬í˜„ ì‹œ ê° AIì˜ API í‚¤ì™€ ì—”ë“œí¬ì¸íŠ¸ í•„ìš”
          
          echo "ğŸ¤– Calling Gemini..."
          # GEMINI_RESULT=$(curl -X POST ... gemini api ...)
          GEMINI_RESULT="[Gemini ì‘ë‹µ ì˜ˆì‹œ: ì•„í‚¤í…ì²˜ ì„¤ê³„ ì™„ë£Œ]"
          
          echo "ğŸ¤– Calling Claude..."
          # CLAUDE_RESULT=$(curl -X POST ... claude api ...)
          CLAUDE_RESULT="[Claude ì‘ë‹µ ì˜ˆì‹œ: êµ¬í˜„ ì½”ë“œ ì‘ì„± ì™„ë£Œ]"
          
          echo "ğŸ¤– Calling Codex..."
          # CODEX_RESULT=$(curl -X POST ... codex api ...)
          CODEX_RESULT="[Codex ì‘ë‹µ ì˜ˆì‹œ: API ì„¤ê³„ ì™„ë£Œ]"
          
          # ê²°ê³¼ ì €ì¥
          echo "::set-output name=gemini::$GEMINI_RESULT"
          echo "::set-output name=claude::$CLAUDE_RESULT"
          echo "::set-output name=codex::$CODEX_RESULT"
      
      - name: Post results to issue
        uses: actions/github-script@v6
        with:
          script: |
            const persona = '${{ steps.analyze.outputs.persona }}';
            const urgency = '${{ steps.analyze.outputs.urgency }}';
            const workflow = '${{ steps.analyze.outputs.workflow }}';
            
            // AI ê²°ê³¼ (ì‹¤ì œë¡œëŠ” steps.ai_results.outputsì—ì„œ ê°€ì ¸ì˜´)
            const geminiResult = '${{ steps.ai_results.outputs.gemini }}';
            const claudeResult = '${{ steps.ai_results.outputs.claude }}';
            const codexResult = '${{ steps.ai_results.outputs.codex }}';
            
            const comment = `## ğŸ¤– AI Orchestra Results
            
            ### ğŸ“Š ë¶„ì„ ê²°ê³¼
            - **í˜ë¥´ì†Œë‚˜**: ${persona}
            - **ê¸´ê¸‰ë„**: ${urgency}
            - **ì›Œí¬í”Œë¡œìš°**: ${workflow}
            
            ### ğŸ¯ AI ì‘ë‹µ
            
            #### Gemini (ì•„í‚¤í…ì²˜)
            \`\`\`
            ${geminiResult}
            \`\`\`
            
            #### Claude (êµ¬í˜„)
            \`\`\`
            ${claudeResult}
            \`\`\`
            
            #### Codex (ë°±ì—”ë“œ)
            \`\`\`
            ${codexResult}
            \`\`\`
            
            ---
            âš¡ Processed by AI Orchestra via GitHub Actions
            ğŸ­ Persona: ${persona}
            â±ï¸ ${new Date().toISOString()}`;
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: comment
            });
            
            // ì²˜ë¦¬ ì™„ë£Œ ë¼ë²¨ ì¶”ê°€
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: ['ai-processed', `persona-${persona}`]
            });
      
      - name: Close issue if completed
        if: steps.analyze.outputs.urgency == 'high'
        uses: actions/github-script@v6
        with:
          script: |
            // ê¸´ê¸‰ ì‘ì—…ì€ ìë™ ì™„ë£Œ ì²˜ë¦¬ (ì„ íƒì )
            const comment = `âœ… ê¸´ê¸‰ ì‘ì—… ìë™ ì™„ë£Œ ì²˜ë¦¬ë¨`;
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: comment
            });
            
            // ì´ìŠˆ ë‹«ê¸° (ì„ íƒì )
            // await github.rest.issues.update({
            //   owner: context.repo.owner,
            //   repo: context.repo.repo,
            //   issue_number: context.issue.number,
            //   state: 'closed'
            // });